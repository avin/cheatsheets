# Основы TLS/SSL

## Терминология

- **TLS (Transport Layer Security)** — современная версия протокола шифрования между клиентом и сервером. SSL 2/3
  считаются устаревшими.
- **Handshake** — стадия, где стороны договариваются о версии протокола, ciphersuite и проверяют сертификаты.
- **Ciphersuite** — набор алгоритмов: key exchange (ECDHE), шифрование (AES-GCM), MAC (SHA256).
- **Forward Secrecy** — свойство, при котором компрометация долгосрочного ключа не раскрывает прошлый трафик (ECDHE,
  X25519).

## TLS 1.2 vs TLS 1.3

| Особенность   | TLS 1.2                 | TLS 1.3                          |
|---------------|-------------------------|----------------------------------|
| Handshake     | 2 RTT                   | 1 RTT (более быстрый)            |
| Cipher suites | много старых (RSA, DHE) | только PFS (ECDHE + AEAD)        |
| Renegotiation | есть                    | удалён                           |
| 0-RTT         | нет                     | есть (ускорение, но риск replay) |

- Рекомендуется включать только TLS 1.2 и TLS 1.3.

## Типы сертификатов

- **DV (Domain Validation)** — проверяется контроль над доменом. Быстрый выпуск (Let's Encrypt).
- **OV (Organization Validation)** — проверяют организацию, требуют больше документов.
- **EV (Extended Validation)** — расширенная проверка (редко используется сейчас).
- **SAN** — Subject Alternative Names; один сертификат для нескольких доменов.
- **Wildcard** — `*.example.com`, но не покрывает вложенные уровни (`a.b.example.com`).

## Chain of Trust

- Сертификат сервиса подписан промежуточным CA, который подписан корневым CA.
- Браузеры и ОС доверяют набору корневых CA (trust store).
- Не забудьте отдавать полный chain (cert + intermediate).

## Key Algorithms

- **RSA** — широко используется, 2048/3072/4096 бит.
- **ECDSA** — эллиптические кривые (P-256, P-384). Короче ключи, быстрее handshake.
- **Ed25519/Ed448** — новые алгоритмы подписи (поддержка в OpenSSL 3+).

## Сценарии взаимной аутентификации

- **mTLS (Mutual TLS)** — клиент предъявляет свой сертификат, сервер проверяет его. Полезно для service-to-service.
- **Client cert auth** — аналог mTLS, часто в корпоративных VPN, админ-панелях.

## Форматы

- **PEM** — базовый формат (`-----BEGIN CERTIFICATE-----`).
- **DER** — бинарный формат.
- **PKCS#12 (.pfx/.p12)** — архив сертификата и ключа.
- **JKS** — Java keystore.
- **CSR** — Certificate Signing Request (публичный ключ + метаданные).

